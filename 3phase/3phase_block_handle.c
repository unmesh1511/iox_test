#include <stdio.h>
#include "my_pub.c"
#include "my_sub.c"
#include "json_parser.c"
#include "iox_error.h"

void result(int rc)
{
	switch (rc) {
		case 0:
			printf("FAILED\n");
			break;
		case 1:
			printf("PASSED\n");
			break;
		case -1:
			printf("unable to parse\n");
			break;
	}
}
void 3phase_block_handle_test1()
{
	pub_start("{\r\n  \"cpPhaseEnable\": {\r\n   \"L1_Phase\" : 1,\r\n   \"L2_Phase\" : 1,\r\n   \"L3_Phase\" : 1\r\n    },\r\n  \"cpCtRatio\": {\r\n   \"L1_ctRatio\" : {\r\n        \"multiplier\" : 10\r\n        },\r\n   \"L2_ctRatio\" : {\r\n        \"multiplier\" : 10\r\n        },\r\n   \"L3_ctRatio\" : {\r\n        \"multiplier\" : 10\r\n        }\r\n    },  \r\n\"nvoVoltageRMS\": {        \r\n    \"monitor\":        {\r\n      \"rate\":500,\r\n        \"cat\":\"data\",\r\n        \"inFeedback\":false,\r\n        \"report\":\"change\",\r\n        \"throttle\":21,\r\n        \"threshold\":31\r\n}\r\n    },\r\n  \"nvoVoltageAvg\": {\r\n    \"monitor\":        {\r\n      \"rate\":300,\r\n        \"cat\":\"data\",\r\n        \"inFeedback\":false,\r\n        \"report\":\"change\",\r\n        \"throttle\":21,\r\n        \"threshold\":31\r\n}\r\n    },\r\n      \"nvoCurrentRMS\": {\r\n        \"monitor\":        {\r\n          \"rate\":550,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoActiveEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":250,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoReactEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":300,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoAppEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":350,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseActEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":400,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseRctEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":450,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseAppEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":500,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPower\": {\r\n        \"monitor\":        {\r\n          \"rate\":550,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseActPwr\": {\r\n        \"monitor\":        {\r\n          \"rate\":600,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseReactPwr\": {\r\n        \"monitor\":        {\r\n          \"rate\":650,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseAppPwr\": {\r\n        \"monitor\":        {\r\n          \"rate\":700,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPowerStatus\": {\r\n        \"monitor\":        {\r\n          \"rate\":500,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseFrequency\": {\r\n        \"monitor\":        {\r\n          \"rate\":400,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n}\r\n  }", "glp/0/17q2d9v/rq/dev/iox/meter/if/phase/0");

	sub_start("glp/0/17q2d9v/rq/dev/iox/meter/if/phase/0");

	result(parser(msg_copy, ERR_PARSE_ARGS));

//	sub_start("glp/0/./=logger/event");
//	sub_start("glp/0/17q2d9v/ev/error");
}

void 3phase_block_handle_test2()
{
	pub_start("{\r\n  \"cpPhaseEnable\": {\r\n   \"L1_Phase\" : 1,\r\n   \"L2_Phase\" : 1,\r\n   \"L3_Phase\" : 1\r\n    },\r\n  \"cpCtRatio\": {\r\n   \"L1_ctRatio\" : {\r\n        \"multiplier\" : 10\r\n        },\r\n   \"L2_ctRatio\" : {\r\n        \"multiplier\" : 10\r\n        },\r\n   \"L3_ctRatio\" : {\r\n        \"multiplier\" : 10\r\n        }\r\n    },  \r\n\"nvoVoltageRMS\": {        \r\n    \"monitor\":        {\r\n      \"rate\":500,\r\n        \"cat\":\"data\",\r\n        \"inFeedback\":false,\r\n        \"report\":\"change\",\r\n        \"throttle\":21,\r\n        \"threshold\":31\r\n}\r\n    },\r\n  \"nvoVoltageAvg\": {\r\n    \"monitor\":        {\r\n      \"rate\":300,\r\n        \"cat\":\"data\",\r\n        \"inFeedback\":false,\r\n        \"report\":\"change\",\r\n        \"throttle\":21,\r\n        \"threshold\":31\r\n}\r\n    },\r\n      \"nvoCurrentRMS\": {\r\n        \"monitor\":        {\r\n          \"rate\":550,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoActiveEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":250,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoReactEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":300,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoAppEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":350,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseActEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":400,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseRctEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":450,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseAppEnergy\": {\r\n        \"monitor\":        {\r\n          \"rate\":500,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPower\": {\r\n        \"monitor\":        {\r\n          \"rate\":550,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseActPwr\": {\r\n        \"monitor\":        {\r\n          \"rate\":600,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseReactPwr\": {\r\n        \"monitor\":        {\r\n          \"rate\":650,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseAppPwr\": {\r\n        \"monitor\":        {\r\n          \"rate\":700,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPowerStatus\": {\r\n        \"monitor\":        {\r\n          \"rate\":500,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n},\r\n      \"nvoPhaseFrequency\": {\r\n        \"monitor\":        {\r\n          \"rate\":400,\r\n          \"cat\":\"data\",\r\n          \"inFeedback\":false,\r\n          \"report\":\"change\",\r\n          \"throttle\":22,\r\n          \"threshold\":32\r\n        }\r\n}\r\n  }", "glp/0/17q2d9v/rq/dev/iox/meter/if/phase/1");

	sub_start("glp/0/17q2d9v/ev/error");
}



void main()
{
	3phase_block_handle_test1();
	3phase_block_handle_test2();
}
